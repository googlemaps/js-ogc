{"version":3,"file":"index.dev.js","sources":["../src/wmsmaptype.ts"],"sourcesContent":["/**\n * Copyright 2019 Google LLC. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/// <reference types=\"@types/google.maps\" />\nimport { stringify } from \"query-string\";\n\n/**\n * @ignore\n */\nconst DEFAULT_WMS_PARAMS = {\n  request: \"GetMap\",\n  service: \"WMS\",\n  srs: \"EPSG:3857\",\n};\n\n/**\n * @ignore\n */\nconst EPSG_3857_EXTENT = 20037508.34789244;\n\n/**\n * @ignore\n */\nconst ORIG_X = -EPSG_3857_EXTENT; // x starts from right\n\n/**\n * @ignore\n */\nconst ORIG_Y = EPSG_3857_EXTENT; // y starts from top\n\n/**\n * Convert xyz tile coordinates to mercator bounds.\n *\n * @param x\n * @param y\n * @param zoom\n * @returns {number[]} minx, miny, maxx, maxy\n */\nfunction xyzToBounds(x: number, y: number, zoom: number): number[] {\n  const tileSize = (EPSG_3857_EXTENT * 2) / Math.pow(2, zoom);\n  const minx = ORIG_X + x * tileSize;\n  const maxx = ORIG_X + (x + 1) * tileSize;\n  const miny = ORIG_Y - (y + 1) * tileSize;\n  const maxy = ORIG_Y - y * tileSize;\n  return [minx, miny, maxx, maxy];\n}\n\ninterface WmsMapTypeOptions {\n  url: string;\n  layers: string;\n  maxZoom: number;\n  styles?: string;\n  bgcolor?: string;\n  version?: string;\n  transparent?: boolean;\n  format?: string;\n  outline?: boolean;\n  name?: string;\n  alt?: string;\n  minZoom?: number;\n  opacity?: number;\n}\n\n/**\n *\n * @param {WmsMapTypeOptions} params\n */\nconst WmsMapType = function ({\n  url,\n  layers,\n  styles = \"\",\n  bgcolor = \"0xFFFFFF\",\n  version = \"1.1.1\",\n  transparent = true,\n  format = \"image/png\",\n  outline = false,\n  // google.maps.ImageMapTypeOptions interface\n  name,\n  alt,\n  maxZoom,\n  minZoom,\n  opacity,\n}: WmsMapTypeOptions): google.maps.ImageMapType {\n  // currently only support tileSize of 256\n  const tileSize = new google.maps.Size(256, 256);\n\n  const params = {\n    layers,\n    styles,\n    version,\n    transparent,\n    bgcolor,\n    format,\n    outline,\n    width: tileSize.width,\n    height: tileSize.height,\n    ...DEFAULT_WMS_PARAMS,\n  };\n\n  if (url.slice(-1) !== \"?\") {\n    url += \"?\";\n  }\n\n  const getTileUrl = function (coord: google.maps.Point, zoom: number): string {\n    return (\n      url +\n      stringify({\n        bbox: xyzToBounds(coord.x, coord.y, zoom).join(\",\"),\n        ...params,\n      })\n    );\n  };\n\n  return new google.maps.ImageMapType({\n    getTileUrl,\n    name,\n    alt,\n    opacity,\n    maxZoom,\n    minZoom,\n    tileSize,\n  });\n};\n\nexport {\n  EPSG_3857_EXTENT,\n  DEFAULT_WMS_PARAMS,\n  xyzToBounds,\n  WmsMapType,\n  WmsMapTypeOptions,\n};\n"],"names":["DEFAULT_WMS_PARAMS","request","service","srs","EPSG_3857_EXTENT","ORIG_X","ORIG_Y","xyzToBounds","x","y","zoom","tileSize","Math","pow","url","layers","styles","bgcolor","version","transparent","format","outline","name","alt","maxZoom","minZoom","opacity","google","maps","Size","params","width","height","slice","ImageMapType","getTileUrl","coord","stringify","bbox","join"],"mappings":"gLAsBA,MAAMA,EAAqB,CACzBC,QAAS,SACTC,QAAS,MACTC,IAAK,aAMDC,EAAmB,kBAKnBC,GAAUD,EAKVE,EAASF,EAUf,SAASG,EAAYC,EAAWC,EAAWC,SACnCC,EAAYP,kBAAwBQ,KAAKC,IAAI,EAAGH,SAK/C,CAJML,EAASG,EAAIG,EAEbL,GAAUG,EAAI,GAAKE,EADnBN,GAAUG,EAAI,GAAKG,EAEnBL,EAASG,EAAIE,uBAwBT,UAAUG,IAC3BA,EAD2BC,OAE3BA,EAF2BC,OAG3BA,EAAS,GAHkBC,QAI3BA,EAAU,WAJiBC,QAK3BA,EAAU,QALiBC,YAM3BA,GAAc,EANaC,OAO3BA,EAAS,YAPkBC,QAQ3BA,GAAU,EARiBC,KAU3BA,EAV2BC,IAW3BA,EAX2BC,QAY3BA,EAZ2BC,QAa3BA,EAb2BC,QAc3BA,UAGMf,EAAW,IAAIgB,OAAOC,KAAKC,KAAK,IAAK,KAErCC,iBACJf,OAAAA,EACAC,OAAAA,EACAE,QAAAA,EACAC,YAAAA,EACAF,QAAAA,EACAG,OAAAA,EACAC,QAAAA,EACAU,MAAOpB,EAASoB,MAChBC,OAAQrB,EAASqB,QACdhC,GAGiB,MAAlBc,EAAImB,OAAO,KACbnB,GAAO,YAaF,IAAIa,OAAOC,KAAKM,aAAa,CAClCC,WAXiB,SAAUC,EAA0B1B,UAEnDI,EACAuB,2BACEC,KAAM/B,EAAY6B,EAAM5B,EAAG4B,EAAM3B,EAAGC,GAAM6B,KAAK,MAC5CT,KAOPR,KAAAA,EACAC,IAAAA,EACAG,QAAAA,EACAF,QAAAA,EACAC,QAAAA,EACAd,SAAAA"}